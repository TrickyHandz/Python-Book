<aside class="sidebar">
  <h3>Table of Contents</h3>
  {% assign lessons_by_section = site.lessons | sort: "order" | group_by: "section" %}

  {% for section in lessons_by_section %}
    <h4>Section {{ section.name }}</h4>
    {% assign sorted = section.items | sort: "order" %}
    {% assign current_lesson = "" %}
    <ul>
      {% for lesson in sorted %}
        {% if lesson.sublesson == 0 %}
          <li><a href="{{ lesson.url | relative_url }}">Lesson {{ lesson.section }}.{{ lesson.lesson }} – {{ lesson.title | remove_first: 'Lesson ' | strip }}</a></li>
        {% else %}
          <ul>
            <li><a href="{{ lesson.url | relative_url }}">Lesson {{ lesson.section }}.{{ lesson.lesson }}.{{ lesson.sublesson | split: '.' | last }} – {{ lesson.title | remove_first: 'Lesson ' | strip }}</a></li>
          </ul>
        {% endif %}
      {% endfor %}
    </ul>
  {% endfor %}
</aside>
